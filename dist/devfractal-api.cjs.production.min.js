"use strict";var r,e=(r=require("axios"))&&"object"==typeof r&&"default"in r?r.default:r,t=require("io-ts-promise"),n=require("query-string"),o=require("technoidentity-utils"),i=require("immer");function c(){return(c=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r}).apply(this,arguments)}function u(r,e){if(null==r)return{};var t,n,o={},i=Object.keys(r);for(n=0;n<i.length;n++)e.indexOf(t=i[n])>=0||(o[t]=r[t]);return o}function s(r){o.verify(o.string.is(r)),o.debug(!r.includes("/"),r+' should not contain "/"')}function a(r){return(void 0!==(t=r.resource)&&""!==t.trim()?(s(t),"/"+t):"")+function(r){if(o.array(o.string).is(r)){var e=r.filter(function(r){return""!==r.trim()});return e.forEach(s),0===e.length?"":"/"+e.join("/")}return o.string.is(r)&&""!==r.trim()?(s(r),"/"+r):""}(r.path)+(void 0===(e=r.query)||0===o.keys(e).length?"":"?"+(o.string.is(e)?e:n.stringify(e)));var e,t}function l(r){return o.string.is(r)?r:a(r)}function f(r){var n=r.baseURL,i=u(r,["baseURL"]),s=e.create(c({},i,{baseURL:o.chop(n)}));return{get:function(r,e){try{return Promise.resolve(s.get(l(r)).then(function(r){return r.data}).then(t.decode(e)))}catch(r){return Promise.reject(r)}},del:function(r){try{return Promise.resolve(s.delete(l(r)))}catch(r){return Promise.reject(r)}},put:function(r,e,n){try{return Promise.resolve(s.put(l(r),e).then(function(r){return r.data}).then(t.decode(n)))}catch(r){return Promise.reject(r)}},post:function(r,e,n){try{return Promise.resolve(s.post(l(r),e).then(function(r){return r.data}).then(t.decode(n)))}catch(r){return Promise.reject(r)}},patch:function(r,e,n){try{return Promise.resolve(s.patch(l(r),e).then(function(r){return r.data}).then(t.decode(n)))}catch(r){return Promise.reject(r)}},axios:s}}var m=o.req({current:o.number,limit:o.number}),y=o.req({start:o.number,end:o.number}),d=o.req({start:o.number,limit:o.number}),h=o.union([y,d]);function p(r){var e=o.getProps(r);return o.opt({select:o.readonlyArray(o.keyof(e)),filter:o.partial(e),range:o.union([m,h]),asc:o.readonlyArray(o.keyof(e)),desc:o.readonlyArray(o.keyof(e)),fullText:o.string,like:o.partial(e),embed:o.keyof(e)})}function g(r){var e=r||{};return Object.keys(e).reduce(function(r,t){return r[t+"_like"]=e[t],r},{})}function v(r,e){return o.cast(p(r),e),n.stringify(c({},e.filter,{},e.range||{},{select:e.select,asc:e.asc,desc:e.desc,q:e.fullText,embed:e.embed},g(e.like)),{arrayFormat:"comma"})}function P(r,e){return i.produce(r,function(r){void 0===r.path?r.path=e:o.UnknownArray.is(r.path)?r.path.unshift(e):r.path=[e,r.path]})}exports.Page=m,exports.Slice=h,exports.buildUrl=a,exports.http=f,exports.rest=function(r,e,t,n){var i=function(e){try{return Promise.resolve(m.get(c({},e,{resource:a}),r))}catch(r){return Promise.reject(r)}},s=function(e){try{return Promise.resolve(m.get(c({},e,{resource:a}),o.readonlyArray(r)))}catch(r){return Promise.reject(r)}},a=t.resource,l=u(t,["resource"]);void 0===n&&(n=v);var m=f(l);return{one:i,many:s,replace:function(e,t,n){try{return Promise.resolve(m.put(P(c({},n,{resource:a}),e),t,r))}catch(r){return Promise.reject(r)}},update:function(e,t,n){try{return Promise.resolve(m.patch(P(c({},n,{resource:a}),e),t,r))}catch(r){return Promise.reject(r)}},create:function(t,n){try{return Promise.resolve(m.post(c({},n,{resource:a}),o.omit(t,[e]),r))}catch(r){return Promise.reject(r)}},del:function(r,e){try{return Promise.resolve(m.del(P(c({},e,{resource:a}),r)))}catch(r){return Promise.reject(r)}},get:function(r,e){try{return i(P(c({},e,{resource:a}),r))}catch(r){return Promise.reject(r)}},list:function(e,t){try{return s(c({query:n(r,e)},t))}catch(r){return Promise.reject(r)}},idKey:e,spec:r,resource:a,http:m,select:function(e,t,i){try{return Promise.resolve(m.get(c({query:n(r,c({},e,{select:t}))},i,{resource:a}),o.readonlyArray(o.objPick(r,t))))}catch(r){return Promise.reject(r)}}}},exports.toAPIQuery=v,exports.toJSONServerQuery=function(r,e){o.cast(p(r),e);var t=m.is(e.range)?{_page:e.range.current,_limit:e.range.limit}:y.is(e.range)?{_start:e.range.start,_end:e.range.end}:d.is(e.range)?{_start:e.range.start,_limit:e.range.limit}:{},i=e.asc,u=e.desc,s=(i||[]).concat(u||[]),a=(i||[]).map(function(r){return"asc"}).concat((u||[]).map(function(r){return"desc"})),l=e.filter,f=e.fullText,h=e.embed;return n.stringify(c({},g(e.like),{},l,{},t,{_sort:s,_order:a,q:f,embed:h}),{arrayFormat:"comma"})};
//# sourceMappingURL=devfractal-api.cjs.production.min.js.map
